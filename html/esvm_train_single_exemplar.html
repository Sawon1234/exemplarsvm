
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>esvm_train_single_exemplar</title><meta name="generator" content="MATLAB 7.12"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2012-02-22"><meta name="DC.source" content="esvm_train_single_exemplar.m"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#3">Set exemplar-initialization parameters</a></li><li><a href="#4">Get the positive stream</a></li><li><a href="#5">Initialize Exemplars</a></li><li><a href="#6">Set exemplar-svm training parameters</a></li><li><a href="#7">Perform Exemplar-SVM training</a></li></ul></div><pre class="codeinput"><span class="comment">% DEMO: Training Exemplar-SVMs from a single image</span>
<span class="comment">%</span>
<span class="comment">% Copyright (C) 2011-12 by Tomasz Malisiewicz</span>
<span class="comment">% (restructured and edited by Abhinav Shrivastava)</span>
<span class="comment">% All rights reserved.</span>
<span class="comment">%</span>
<span class="comment">% This file is part of the Exemplar-SVM library and is made</span>
<span class="comment">% available under the terms of the MIT license (see COPYING file).</span>
<span class="comment">% Project homepage: https://github.com/quantombone/exemplarsvm</span>
<span class="comment">%</span>
<span class="keyword">function</span> [models] = my_esvm_train_exemplar(I, bb, negFolder)
</pre><pre class="codeinput"><span class="comment">% Train model for a single image</span>
<span class="comment">% [models]: Trained model</span>
<span class="comment">% [I]: Input image in double format</span>
<span class="comment">% [bb]: Bounding box of the object of interest</span>
<span class="comment">% (for complete image bb should be [1 1 size(I,2) size(I,1)]</span>
<span class="comment">% [negFolder]: Folder path (string) that contains negative images</span>

addpath(genpath(pwd))

[pos_set, neg_set] = esvm_get_positive_negative_sets(I, bb, negFolder);

models_name = <span class="string">'image'</span>;
</pre><pre class="codeoutput">Input argument "I" is undefined.

Error in ==&gt; esvm_train_single_exemplar at 21
[pos_set, neg_set] = esvm_get_positive_negative_sets(I, bb, negFolder);
</pre><h2>Set exemplar-initialization parameters<a name="3"></a></h2><pre class="codeinput">params = esvm_get_default_params;
params.init_params.sbin = 8;
params.init_params.MAXDIM = 15;
params.model_type = <span class="string">'exemplar'</span>;

<span class="comment">%enable display so that nice visualizations pop up during learning</span>
params.dataset_params.display = 1;

<span class="comment">%if localdir is not set, we do not dump files</span>
<span class="comment">%params.dataset_params.localdir = '/nfs/baikal/tmalisie/synthetic/';</span>

<span class="comment">%%Initialize exemplar stream</span>
stream_params.stream_set_name = <span class="string">'trainval'</span>;
stream_params.stream_max_ex = 10;
stream_params.must_have_seg = 0;
stream_params.must_have_seg_string = <span class="string">''</span>;
stream_params.model_type = <span class="string">'exemplar'</span>; <span class="comment">%must be scene or exemplar</span>
<span class="comment">%assign pos_set as variable, because we need it for visualization</span>
stream_params.pos_set = pos_set;
stream_params.cls = <span class="string">''</span>;
</pre><h2>Get the positive stream<a name="4"></a></h2><pre class="codeinput">e_stream_set = esvm_get_pascal_stream(stream_params, params.dataset_params);
</pre><h2>Initialize Exemplars<a name="5"></a></h2><p>Each exemplar will have a figure, where on the first image is the exemplar's image, along with the exemplar bounding box and HOG grid overlayed.  The second image shows the HOG mask along with its offset to the ground-truth bounding box.  The third image shows the initial HOG features used to define the exemplar.</p><pre class="codeinput">initial_models = esvm_initialize_exemplars(e_stream_set, params, <span class="keyword">...</span>
                                           models_name);
</pre><h2>Set exemplar-svm training parameters<a name="6"></a></h2><pre class="codeinput">train_params = params;
train_params.detect_max_scale = 1.0;
train_params.train_max_mined_images = 10000;
train_params.detect_max_windows_per_exemplar = 400;
</pre><h2>Perform Exemplar-SVM training<a name="7"></a></h2><p>Because display is turned on, we will show the result of each exemplar's training iteration.   Each iteration shows a diagnostic first column then the remaining rows are the top negative support vectors used to define the exemplar's decision boundary.  The diagnostic row shows: exemplar, w's positive part, w's negative part, and four mean support vector images, where the means are computed with the first 1:N/4, 1:N/2, .. , 1:N support vectors.</p><pre class="codeinput">[models] = esvm_train_exemplars(initial_models, <span class="keyword">...</span>
                                neg_set, train_params);
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.12<br></p></div><!--
##### SOURCE BEGIN #####
% DEMO: Training Exemplar-SVMs from a single image
%
% Copyright (C) 2011-12 by Tomasz Malisiewicz 
% (restructured and edited by Abhinav Shrivastava)
% All rights reserved. 
%
% This file is part of the Exemplar-SVM library and is made
% available under the terms of the MIT license (see COPYING file).
% Project homepage: https://github.com/quantombone/exemplarsvm
%
function [models] = my_esvm_train_exemplar(I, bb, negFolder)
% Train model for a single image
% [models]: Trained model
% [I]: Input image in double format
% [bb]: Bounding box of the object of interest 
% (for complete image bb should be [1 1 size(I,2) size(I,1)] 
% [negFolder]: Folder path (string) that contains negative images

addpath(genpath(pwd))

[pos_set, neg_set] = esvm_get_positive_negative_sets(I, bb, negFolder);

models_name = 'image';

%% Set exemplar-initialization parameters
params = esvm_get_default_params;
params.init_params.sbin = 8;
params.init_params.MAXDIM = 15;
params.model_type = 'exemplar';

%enable display so that nice visualizations pop up during learning
params.dataset_params.display = 1;

%if localdir is not set, we do not dump files
%params.dataset_params.localdir = '/nfs/baikal/tmalisie/synthetic/';

%%Initialize exemplar stream
stream_params.stream_set_name = 'trainval';
stream_params.stream_max_ex = 10;
stream_params.must_have_seg = 0;
stream_params.must_have_seg_string = '';
stream_params.model_type = 'exemplar'; %must be scene or exemplar
%assign pos_set as variable, because we need it for visualization
stream_params.pos_set = pos_set;
stream_params.cls = '';

%% Get the positive stream
e_stream_set = esvm_get_pascal_stream(stream_params, params.dataset_params);

%% Initialize Exemplars
% Each exemplar will have a figure, where on the first image is
% the exemplar's image, along with the exemplar bounding box and
% HOG grid overlayed.  The second image shows the HOG mask along
% with its offset to the ground-truth bounding box.  The third
% image shows the initial HOG features used to define the exemplar.
initial_models = esvm_initialize_exemplars(e_stream_set, params, ...
                                           models_name);

%% Set exemplar-svm training parameters
train_params = params;
train_params.detect_max_scale = 1.0;
train_params.train_max_mined_images = 10000;
train_params.detect_max_windows_per_exemplar = 400;

%% Perform Exemplar-SVM training
% Because display is turned on, we will show the result of each
% exemplar's training iteration.   Each iteration shows a
% diagnostic first column then the remaining rows are the top
% negative support vectors used to define the exemplar's decision
% boundary.  The diagnostic row shows: exemplar, w's positive
% part, w's negative part, and four mean support vector images,
% where the means are computed with the first 1:N/4, 1:N/2, .. ,
% 1:N support vectors.
[models] = esvm_train_exemplars(initial_models, ...
                                neg_set, train_params);

##### SOURCE END #####
--></body></html>